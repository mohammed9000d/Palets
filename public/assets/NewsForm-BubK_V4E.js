import{a0 as T,a5 as I,r as l,j as e,M,B as n,T as A,N as R,a1 as W}from"./index-DJ-mX6Fk.js";import{n as j}from"./api-T5aaLTAo.js";import{g as B}from"./imageHelper-D6Ik51Rl.js";import{A as N}from"./Alert-DLo_mUvi.js";import{T as f}from"./TextField-BUP45Fpy.js";import{B as g}from"./Button-Bm3vhWTS.js";import"./InputLabel-C7p_2NM4.js";const G=()=>{const w=T(),{id:d}=I(),u=!!d,[i,v]=l.useState({main_title:"",sub_title:"",description:"",author_name:"",cover_photo:null,author_photo:null}),[h,y]=l.useState({cover_photo:null,author_photo:null}),[a,p]=l.useState(!1),[C,m]=l.useState(""),[S,_]=l.useState("");l.useEffect(()=>{u&&P()},[d,u]);const P=async()=>{try{p(!0);const t=(await j.getById(d)).data.data;v({main_title:t.main_title||"",sub_title:t.sub_title||"",description:t.description||"",author_name:t.author_name||"",cover_photo:null,author_photo:null}),y({cover_photo:t.cover_photo?B(t.cover_photo):null,author_photo:t.author_photo?B(t.author_photo):null})}catch(s){m("Error fetching news data"),console.error("Error fetching news:",s)}finally{p(!1)}},x=s=>{const{name:t,value:o}=s.target;v(r=>({...r,[t]:o}))},E=(s,t)=>{const o=s.target.files[0];if(o){v(c=>({...c,[t]:o}));const r=new FileReader;r.onload=c=>{y(b=>({...b,[t]:c.target.result}))},r.readAsDataURL(o)}},D=async s=>{var t,o;s.preventDefault(),p(!0),m(""),_("");try{u?(await j.update(d,i),_("News updated successfully!")):(await j.create(i),_("News created successfully!")),setTimeout(()=>{w("/admin/news")},2e3)}catch(r){if((o=(t=r.response)==null?void 0:t.data)!=null&&o.errors){const c=r.response.data.errors,b=Object.values(c).flat().join(", ");m(b)}else m("Failed to save news. Please try again.");console.error("Error saving news:",r)}finally{p(!1)}},F=()=>{w("/admin/news")};return e.jsxs(M,{title:u?"Edit News":"Create News",children:[C&&e.jsx(N,{severity:"error",sx:{mb:2},children:C}),S&&e.jsx(N,{severity:"success",sx:{mb:2},children:S}),e.jsx(n,{component:"form",onSubmit:D,noValidate:!0,children:e.jsxs(n,{sx:{display:"flex",flexDirection:"column",gap:3},children:[e.jsx(f,{fullWidth:!0,label:"Main Title",name:"main_title",value:i.main_title,onChange:x,required:!0,disabled:a}),e.jsx(f,{fullWidth:!0,label:"Sub Title",name:"sub_title",value:i.sub_title,onChange:x,disabled:a}),e.jsx(f,{fullWidth:!0,label:"Description",name:"description",value:i.description,onChange:x,required:!0,multiline:!0,rows:6,disabled:a}),e.jsx(f,{fullWidth:!0,label:"Author Name",name:"author_name",value:i.author_name,onChange:x,required:!0,disabled:a}),e.jsxs(n,{children:[e.jsx(A,{variant:"subtitle1",gutterBottom:!0,children:"Cover Photo"}),e.jsxs(n,{display:"flex",alignItems:"center",gap:2,children:[e.jsxs(g,{variant:"outlined",component:"label",disabled:a,children:["Choose Cover Photo",e.jsx("input",{type:"file",hidden:!0,accept:"image/*",onChange:s=>E(s,"cover_photo")})]}),h.cover_photo&&e.jsx(n,{component:"img",src:h.cover_photo,alt:"Cover preview",sx:{width:80,height:80,objectFit:"cover",borderRadius:1,border:"1px solid #ddd"}})]})]}),e.jsxs(n,{children:[e.jsx(A,{variant:"subtitle1",gutterBottom:!0,children:"Author Photo"}),e.jsxs(n,{display:"flex",alignItems:"center",gap:2,children:[e.jsxs(g,{variant:"outlined",component:"label",disabled:a,children:["Choose Author Photo",e.jsx("input",{type:"file",hidden:!0,accept:"image/*",onChange:s=>E(s,"author_photo")})]}),h.author_photo&&e.jsx(R,{src:h.author_photo,sx:{width:80,height:80}})]})]}),e.jsxs(n,{sx:{display:"flex",gap:2,justifyContent:"flex-end"},children:[e.jsx(g,{variant:"outlined",onClick:F,disabled:a,children:"Cancel"}),e.jsx(g,{type:"submit",variant:"contained",disabled:a,startIcon:a?e.jsx(W,{size:20}):null,children:a?"Saving...":u?"Update":"Create"})]})]})})]})};export{G as default};
