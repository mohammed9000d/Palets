import{a8 as re,a0 as ue,a5 as he,r as h,j as e,B as u,a1 as V,M as pe,G as o,S as g,J as j,Z as f,ah as me,K as v,T as b,a3 as ge,F as E,ab as q,N as B,I as z}from"./index-DNfr9x4F.js";import{p as M}from"./api-BQFhURCH.js";import{A as Y}from"./Alert-76NRBqFV.js";import{T as d,S as ee}from"./TextField-DKgUwB6G.js";import{I as y}from"./InputAdornment-BdIkfXyw.js";import{I as te}from"./IconTag-DxkSIVBI.js";import{I as xe}from"./IconCurrencyDollar-pzAVijOn.js";import{I as _e}from"./IconPackage-oLjh9KB8.js";import{F as se,I as ie}from"./InputLabel-C2axVWU7.js";import{M as S}from"./MenuItem-D6U65LhZ.js";import{B as P}from"./Button-CLm7eKfg.js";import{S as R}from"./Switch-dGSHYd5q.js";import{I as je}from"./IconStar-nwd44-Gm.js";import{I as K}from"./IconTrash-D5OUtA2T.js";/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var fe=re("outline","dimensions","IconDimensions",[["path",{d:"M3 5h11",key:"svg-0"}],["path",{d:"M12 7l2 -2l-2 -2",key:"svg-1"}],["path",{d:"M5 3l-2 2l2 2",key:"svg-2"}],["path",{d:"M19 10v11",key:"svg-3"}],["path",{d:"M17 19l2 2l2 -2",key:"svg-4"}],["path",{d:"M21 12l-2 -2l-2 2",key:"svg-5"}],["path",{d:"M3 10m0 2a2 2 0 0 1 2 -2h7a2 2 0 0 1 2 2v7a2 2 0 0 1 -2 2h-7a2 2 0 0 1 -2 -2z",key:"svg-6"}]]);/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var ve=re("outline","truck","IconTruck",[["path",{d:"M7 17m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0",key:"svg-0"}],["path",{d:"M17 17m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0",key:"svg-1"}],["path",{d:"M5 17h-2v-11a1 1 0 0 1 1 -1h9v12m-4 0h6m4 0h2v-6h-8m0 -5h5l3 5",key:"svg-2"}]]);const Ee=()=>{const L=ue(),{slug:C}=he(),m=!!C,[I,w]=h.useState(!1),[U,W]=h.useState(""),[$,O]=h.useState(""),[r,x]=h.useState({main_title:"",sub_title:"",description:"",price:"",discount_price:"",product_details:"",in_stock:!0,is_custom_dimension:!1,status:"draft",is_featured:!1,sku:"",category:"",stock_quantity:0,min_order_quantity:1,dimensions:{width:"",height:"",depth:"",weight:""},tags:[],shipping_info:{shipping_cost:"",shipping_time:"",free_shipping_threshold:""},meta_data:{}}),[H,T]=h.useState({cover_photo:null,product_images:[]}),[k,A]=h.useState({cover_photo:null,product_images:[]}),[_,D]=h.useState({cover_photo:null,product_images:[]}),[F,N]=h.useState(""),[oe,ne]=h.useState([]);h.useEffect(()=>{m&&C&&le(),ae()},[m,C]);const ae=async()=>{try{const s=await M.getCategories();ne(s.data.categories||[])}catch(s){console.error("Error loading categories:",s)}},le=async()=>{w(!0);try{const t=(await M.getBySlug(C)).data.product;x({main_title:t.main_title||"",sub_title:t.sub_title||"",description:t.description||"",price:t.price||"",discount_price:t.discount_price||"",product_details:t.product_details||"",in_stock:t.in_stock,is_custom_dimension:t.is_custom_dimension,status:t.status||"draft",is_featured:t.is_featured,sku:t.sku||"",category:t.category||"",stock_quantity:t.stock_quantity||0,min_order_quantity:t.min_order_quantity||1,dimensions:t.dimensions||{width:"",height:"",depth:"",weight:""},tags:t.tags||[],shipping_info:t.shipping_info||{shipping_cost:"",shipping_time:"",free_shipping_threshold:""},meta_data:t.meta_data||{}}),t.cover_photo_url&&D(i=>({...i,cover_photo:t.cover_photo_url})),t.product_images&&t.product_images.length>0&&D(i=>({...i,product_images:t.product_images.map(l=>({id:l.id,url:l.url,thumb:l.thumb}))}))}catch(s){W("Failed to load product data"),console.error("Error loading product:",s)}finally{w(!1)}},n=s=>{const{name:t,value:i,checked:l}=s.target;if(t.startsWith("dimensions_")){const c=t.replace("dimensions_","");x(a=>({...a,dimensions:{...a.dimensions,[c]:i}}))}else if(t.startsWith("shipping_")){const c=t.replace("shipping_","");x(a=>({...a,shipping_info:{...a.shipping_info,[c]:i}}))}else x(c=>({...c,[t]:["in_stock","is_custom_dimension","is_featured"].includes(t)?l:i}))},G=(s,t)=>{const i=Array.from(s.target.files);if(t==="cover_photo"&&i.length>0){const l=i[0];T(a=>({...a,cover_photo:l}));const c=new FileReader;c.onload=a=>{A(p=>({...p,cover_photo:a.target.result}))},c.readAsDataURL(l)}else t==="product_images"&&i.length>0&&(T(l=>({...l,product_images:[...l.product_images,...i]})),i.forEach(l=>{const c=new FileReader;c.onload=a=>{A(p=>({...p,product_images:[...p.product_images,a.target.result]}))},c.readAsDataURL(l)}))},Q=(s,t=null)=>{s==="cover_photo"?(T(i=>({...i,cover_photo:null})),A(i=>({...i,cover_photo:null}))):s==="product_images"&&t!==null&&(T(i=>({...i,product_images:i.product_images.filter((l,c)=>c!==t)})),A(i=>({...i,product_images:i.product_images.filter((l,c)=>c!==t)})))},J=(s,t=null)=>{s==="cover_photo"?D(i=>({...i,cover_photo:null})):s==="product_images"&&t&&D(i=>({...i,product_images:i.product_images.filter(l=>l.id!==t)}))},X=()=>{F.trim()&&!r.tags.includes(F.trim())&&(x(s=>({...s,tags:[...s.tags,F.trim()]})),N(""))},ce=s=>{x(t=>({...t,tags:t.tags.filter(i=>i!==s)}))},de=async s=>{var t,i,l,c;s.preventDefault(),w(!0),W(""),O("");try{const a={...r,...H};if(m){_.cover_photo===null&&!H.cover_photo&&(a.remove_cover_photo=!0);const Z=[];Z.length>0&&(a.remove_product_images=Z)}let p;m?p=await M.update(C,a):p=await M.create(a),O(`Product ${m?"updated":"created"} successfully!`),setTimeout(()=>{L("/products")},1500)}catch(a){if(console.error("Error submitting product:",a),(i=(t=a.response)==null?void 0:t.data)!=null&&i.errors){const p=Object.values(a.response.data.errors).flat().join(", ");W(p)}else W(((c=(l=a.response)==null?void 0:l.data)==null?void 0:c.message)||"Failed to save product")}finally{w(!1)}};return I&&m?e.jsx(u,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsx(V,{})}):e.jsx(pe,{title:`${m?"Edit":"Create"} Product`,children:e.jsxs(u,{component:"form",onSubmit:de,children:[U&&e.jsx(Y,{severity:"error",sx:{mb:3},children:U}),$&&e.jsx(Y,{severity:"success",sx:{mb:3},children:$}),e.jsxs(o,{container:!0,spacing:3,children:[e.jsx(o,{item:!0,xs:12,md:8,children:e.jsxs(g,{spacing:3,children:[e.jsxs(j,{children:[e.jsx(f,{title:"Basic Information",avatar:e.jsx(me,{}),sx:{bgcolor:"primary.light",color:"primary.contrastText"}}),e.jsx(v,{children:e.jsxs(g,{spacing:2,children:[e.jsx(d,{name:"main_title",label:"Product Title",value:r.main_title,onChange:n,fullWidth:!0,required:!0,InputProps:{startAdornment:e.jsx(y,{position:"start",children:e.jsx(te,{})})}}),e.jsx(d,{name:"sub_title",label:"Sub Title",value:r.sub_title,onChange:n,fullWidth:!0,placeholder:"Optional subtitle or tagline"}),e.jsx(d,{name:"description",label:"Description",value:r.description,onChange:n,fullWidth:!0,multiline:!0,rows:4,placeholder:"Detailed product description..."}),e.jsx(d,{name:"product_details",label:"Product Details",value:r.product_details,onChange:n,fullWidth:!0,multiline:!0,rows:3,placeholder:"Technical specifications, materials, etc."})]})})]}),e.jsxs(j,{children:[e.jsx(f,{title:"Pricing & Inventory",avatar:e.jsx(xe,{}),sx:{bgcolor:"success.light",color:"success.contrastText"}}),e.jsx(v,{children:e.jsxs(o,{container:!0,spacing:2,children:[e.jsx(o,{item:!0,xs:12,sm:6,children:e.jsx(d,{name:"price",label:"Regular Price",value:r.price,onChange:n,fullWidth:!0,required:!0,type:"number",step:"0.01",InputProps:{startAdornment:e.jsx(y,{position:"start",children:"$"})}})}),e.jsx(o,{item:!0,xs:12,sm:6,children:e.jsx(d,{name:"discount_price",label:"Sale Price",value:r.discount_price,onChange:n,fullWidth:!0,type:"number",step:"0.01",InputProps:{startAdornment:e.jsx(y,{position:"start",children:"$"})},placeholder:"Optional discount price"})}),e.jsx(o,{item:!0,xs:12,sm:4,children:e.jsx(d,{name:"sku",label:"SKU",value:r.sku,onChange:n,fullWidth:!0,placeholder:"Auto-generated if empty"})}),e.jsx(o,{item:!0,xs:12,sm:4,children:e.jsx(d,{name:"stock_quantity",label:"Stock Quantity",value:r.stock_quantity,onChange:n,fullWidth:!0,type:"number",min:"0",InputProps:{startAdornment:e.jsx(y,{position:"start",children:e.jsx(_e,{})})}})}),e.jsx(o,{item:!0,xs:12,sm:4,children:e.jsx(d,{name:"min_order_quantity",label:"Min Order Qty",value:r.min_order_quantity,onChange:n,fullWidth:!0,type:"number",min:"1"})})]})})]}),e.jsxs(j,{children:[e.jsx(f,{title:"Category & Tags",avatar:e.jsx(te,{}),sx:{bgcolor:"warning.light",color:"warning.contrastText"}}),e.jsx(v,{children:e.jsxs(g,{spacing:2,children:[e.jsxs(se,{fullWidth:!0,children:[e.jsx(ie,{children:"Category"}),e.jsxs(ee,{name:"category",value:r.category,onChange:n,label:"Category",children:[e.jsx(S,{value:"",children:e.jsx("em",{children:"Select a category"})}),oe.map(s=>e.jsx(S,{value:s,children:s},s))]})]}),e.jsxs(u,{children:[e.jsx(b,{variant:"subtitle2",gutterBottom:!0,children:"Tags"}),e.jsxs(u,{display:"flex",gap:1,alignItems:"center",mb:1,children:[e.jsx(d,{value:F,onChange:s=>N(s.target.value),placeholder:"Add a tag",size:"small",onKeyPress:s=>{s.key==="Enter"&&(s.preventDefault(),X())}}),e.jsx(P,{onClick:X,variant:"outlined",size:"small",children:"Add"})]}),e.jsx(u,{display:"flex",flexWrap:"wrap",gap:1,children:r.tags.map((s,t)=>e.jsx(ge,{label:s,onDelete:()=>ce(s),color:"primary",variant:"outlined"},t))})]})]})})]}),e.jsxs(j,{children:[e.jsx(f,{title:"Dimensions & Shipping",avatar:e.jsx(fe,{}),sx:{bgcolor:"info.light",color:"info.contrastText"}}),e.jsx(v,{children:e.jsxs(g,{spacing:2,children:[e.jsx(E,{control:e.jsx(R,{name:"is_custom_dimension",checked:r.is_custom_dimension,onChange:n}),label:"Custom Dimensions Available"}),e.jsxs(o,{container:!0,spacing:2,children:[e.jsx(o,{item:!0,xs:6,sm:3,children:e.jsx(d,{name:"dimensions_width",label:"Width",value:r.dimensions.width,onChange:n,fullWidth:!0,placeholder:"cm"})}),e.jsx(o,{item:!0,xs:6,sm:3,children:e.jsx(d,{name:"dimensions_height",label:"Height",value:r.dimensions.height,onChange:n,fullWidth:!0,placeholder:"cm"})}),e.jsx(o,{item:!0,xs:6,sm:3,children:e.jsx(d,{name:"dimensions_depth",label:"Depth",value:r.dimensions.depth,onChange:n,fullWidth:!0,placeholder:"cm"})}),e.jsx(o,{item:!0,xs:6,sm:3,children:e.jsx(d,{name:"dimensions_weight",label:"Weight",value:r.dimensions.weight,onChange:n,fullWidth:!0,placeholder:"kg"})})]}),e.jsx(b,{variant:"h6",gutterBottom:!0,sx:{mt:2},children:"Shipping Information"}),e.jsxs(o,{container:!0,spacing:2,children:[e.jsx(o,{item:!0,xs:12,sm:4,children:e.jsx(d,{name:"shipping_shipping_cost",label:"Shipping Cost",value:r.shipping_info.shipping_cost,onChange:n,fullWidth:!0,InputProps:{startAdornment:e.jsx(y,{position:"start",children:e.jsx(ve,{})})}})}),e.jsx(o,{item:!0,xs:12,sm:4,children:e.jsx(d,{name:"shipping_shipping_time",label:"Shipping Time",value:r.shipping_info.shipping_time,onChange:n,fullWidth:!0,placeholder:"e.g., 3-5 business days"})}),e.jsx(o,{item:!0,xs:12,sm:4,children:e.jsx(d,{name:"shipping_free_shipping_threshold",label:"Free Shipping Above",value:r.shipping_info.free_shipping_threshold,onChange:n,fullWidth:!0,type:"number",InputProps:{startAdornment:e.jsx(y,{position:"start",children:"$"})}})})]})]})})]})]})}),e.jsx(o,{item:!0,xs:12,md:4,children:e.jsxs(g,{spacing:3,children:[e.jsxs(j,{children:[e.jsx(f,{title:"Status & Settings",avatar:e.jsx(je,{}),sx:{bgcolor:"secondary.light",color:"secondary.contrastText"}}),e.jsx(v,{children:e.jsxs(g,{spacing:2,children:[e.jsxs(se,{fullWidth:!0,children:[e.jsx(ie,{children:"Status"}),e.jsxs(ee,{name:"status",value:r.status,onChange:n,label:"Status",children:[e.jsx(S,{value:"draft",children:"Draft"}),e.jsx(S,{value:"published",children:"Published"}),e.jsx(S,{value:"archived",children:"Archived"})]})]}),e.jsx(E,{control:e.jsx(R,{name:"in_stock",checked:r.in_stock,onChange:n}),label:"In Stock"}),e.jsx(E,{control:e.jsx(R,{name:"is_featured",checked:r.is_featured,onChange:n}),label:"Featured Product"})]})})]}),e.jsxs(j,{children:[e.jsx(f,{title:"Product Images",avatar:e.jsx(q,{}),sx:{bgcolor:"primary.light",color:"primary.contrastText"}}),e.jsx(v,{children:e.jsxs(g,{spacing:3,children:[e.jsxs(u,{children:[e.jsx(b,{variant:"subtitle2",gutterBottom:!0,children:"Cover Photo"}),(k.cover_photo||_.cover_photo)&&e.jsxs(u,{position:"relative",mb:2,children:[e.jsx(B,{src:k.cover_photo||_.cover_photo,sx:{width:120,height:120,mx:"auto"},variant:"rounded"}),e.jsx(z,{onClick:()=>{Q("cover_photo"),J("cover_photo")},sx:{position:"absolute",top:0,right:"50%",transform:"translateX(50%)",bgcolor:"error.main",color:"white","&:hover":{bgcolor:"error.dark"}},size:"small",children:e.jsx(K,{size:16})})]}),e.jsxs(P,{variant:"outlined",component:"label",fullWidth:!0,startIcon:e.jsx(q,{}),children:[_.cover_photo||k.cover_photo?"Change Cover Photo":"Upload Cover Photo",e.jsx("input",{type:"file",hidden:!0,accept:"image/*",onChange:s=>G(s,"cover_photo")})]})]}),e.jsxs(u,{children:[e.jsx(b,{variant:"subtitle2",gutterBottom:!0,children:"Product Images"}),_.product_images.length>0&&e.jsxs(u,{mb:2,children:[e.jsx(b,{variant:"caption",color:"textSecondary",children:"Existing Images"}),e.jsx(o,{container:!0,spacing:1,sx:{mt:.5},children:_.product_images.map(s=>e.jsx(o,{item:!0,xs:6,children:e.jsxs(u,{position:"relative",children:[e.jsx(B,{src:s.thumb||s.url,sx:{width:80,height:80},variant:"rounded"}),e.jsx(z,{onClick:()=>J("product_images",s.id),sx:{position:"absolute",top:-8,right:-8,bgcolor:"error.main",color:"white","&:hover":{bgcolor:"error.dark"}},size:"small",children:e.jsx(K,{size:12})})]})},s.id))})]}),k.product_images.length>0&&e.jsxs(u,{mb:2,children:[e.jsx(b,{variant:"caption",color:"textSecondary",children:"New Images"}),e.jsx(o,{container:!0,spacing:1,sx:{mt:.5},children:k.product_images.map((s,t)=>e.jsx(o,{item:!0,xs:6,children:e.jsxs(u,{position:"relative",children:[e.jsx(B,{src:s,sx:{width:80,height:80},variant:"rounded"}),e.jsx(z,{onClick:()=>Q("product_images",t),sx:{position:"absolute",top:-8,right:-8,bgcolor:"error.main",color:"white","&:hover":{bgcolor:"error.dark"}},size:"small",children:e.jsx(K,{size:12})})]})},t))})]}),e.jsxs(P,{variant:"outlined",component:"label",fullWidth:!0,startIcon:e.jsx(q,{}),children:["Add Product Images",e.jsx("input",{type:"file",hidden:!0,accept:"image/*",multiple:!0,onChange:s=>G(s,"product_images")})]})]})]})})]})]})})]}),e.jsxs(u,{mt:4,display:"flex",gap:2,justifyContent:"flex-end",children:[e.jsx(P,{variant:"outlined",onClick:()=>L("/products"),disabled:I,children:"Cancel"}),e.jsx(P,{type:"submit",variant:"contained",disabled:I,startIcon:I&&e.jsx(V,{size:20}),children:I?"Saving...":m?"Update Product":"Create Product"})]})]})})};export{Ee as default};
