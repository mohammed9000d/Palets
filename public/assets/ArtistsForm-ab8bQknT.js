import{a0 as q,a5 as K,r as h,j as e,M as V,B as m,T as F,N as H,I,F as J,a1 as Q}from"./index-DJ-mX6Fk.js";import{b as E}from"./api-T5aaLTAo.js";import{A as U}from"./Alert-DLo_mUvi.js";import{T as u}from"./TextField-BUP45Fpy.js";import{B as C}from"./Button-Bm3vhWTS.js";import{I as R}from"./IconTrash-BnUoyHZy.js";import{S as X}from"./Switch-Dja_XEYG.js";import"./InputLabel-C7p_2NM4.js";const re=()=>{const L=q(),{slug:f}=K(),x=!!f,[r,_]=h.useState(!1),[P,p]=h.useState(""),[B,w]=h.useState(""),[o,A]=h.useState({artist_name:"",bio:"",link:"",is_active:!0,social_links:{instagram:"",twitter:"",facebook:"",linkedin:"",youtube:"",website:""},contact_email:"",phone:"",specialties:"",commission_rate:""}),[T,v]=h.useState({avatar:null,gallery_images:[]}),[y,j]=h.useState({avatar:null,gallery_images:[]}),[g,k]=h.useState({avatar:null,gallery:[]});h.useEffect(()=>{x&&f&&z()},[x,f]);const z=async()=>{var a,t,c,s,i,l;_(!0);try{const n=(await E.getBySlug(f)).data.artist;A({artist_name:n.artist_name||"",bio:n.bio||"",link:n.link||"",is_active:n.is_active,social_links:{instagram:((a=n.social_links)==null?void 0:a.instagram)||"",twitter:((t=n.social_links)==null?void 0:t.twitter)||"",facebook:((c=n.social_links)==null?void 0:c.facebook)||"",linkedin:((s=n.social_links)==null?void 0:s.linkedin)||"",youtube:((i=n.social_links)==null?void 0:i.youtube)||"",website:((l=n.social_links)==null?void 0:l.website)||""},contact_email:n.contact_email||"",phone:n.phone||"",specialties:n.specialties||"",commission_rate:n.commission_rate||""}),n.avatar_url&&k(S=>({...S,avatar:n.avatar_url})),n.gallery_images&&n.gallery_images.length>0&&k(S=>({...S,gallery:n.gallery_images.map(W=>({id:W.id,url:W.url,thumb:W.thumb}))}))}catch(b){p("Failed to load artist data"),console.error("Error loading artist:",b)}finally{_(!1)}},d=a=>{const{name:t,value:c,checked:s}=a.target;if(t.startsWith("social_")){const i=t.replace("social_","");A(l=>({...l,social_links:{...l.social_links,[i]:c}}))}else A(i=>({...i,[t]:t==="is_active"?s:c}))},D=(a,t)=>{const c=Array.from(a.target.files);if(t==="avatar"&&c.length>0){const s=c[0];v(l=>({...l,avatar:s}));const i=new FileReader;i.onload=l=>{j(b=>({...b,avatar:l.target.result}))},i.readAsDataURL(s)}else t==="gallery"&&c.length>0&&(v(s=>({...s,gallery_images:[...s.gallery_images,...c]})),c.forEach(s=>{const i=new FileReader;i.onload=l=>{j(b=>({...b,gallery_images:[...b.gallery_images,l.target.result]}))},i.readAsDataURL(s)}))},G=()=>{v(a=>({...a,avatar:null})),j(a=>({...a,avatar:null})),k(a=>({...a,avatar:null}))},M=a=>{v(t=>({...t,gallery_images:t.gallery_images.filter((c,s)=>s!==a)})),j(t=>({...t,gallery_images:t.gallery_images.filter((c,s)=>s!==a)}))},N=a=>{k(t=>({...t,gallery:t.gallery.filter((c,s)=>s!==a)}))},O=async a=>{var t,c;a.preventDefault(),_(!0),p(""),w("");try{const s={};Object.keys(o.social_links).forEach(l=>{o.social_links[l]&&o.social_links[l].trim()!==""&&(s[l]=o.social_links[l].trim())});const i={...o,social_links:s,...T};x&&(i.remove_avatar=!g.avatar,g.gallery&&g.gallery.length>0?i.existing_gallery_ids=g.gallery.map(l=>l.id):i.existing_gallery_ids=[]),x?(await E.update(f,i),w("Artist updated successfully!")):(await E.create(i),w("Artist created successfully!")),setTimeout(()=>{L("/admin/artists")},2e3)}catch(s){if((c=(t=s.response)==null?void 0:t.data)!=null&&c.errors){const i=s.response.data.errors,l=Object.values(i).flat().join(", ");p(l)}else p("Failed to save artist. Please try again.");console.error("Error saving artist:",s)}finally{_(!1)}},$=()=>{L("/admin/artists")};return e.jsxs(V,{title:x?"Edit Artist":"Create Artist",children:[P&&e.jsx(U,{severity:"error",sx:{mb:2},children:P}),B&&e.jsx(U,{severity:"success",sx:{mb:2},children:B}),e.jsx(m,{component:"form",onSubmit:O,noValidate:!0,children:e.jsxs(m,{sx:{display:"flex",flexDirection:"column",gap:3},children:[e.jsx(u,{fullWidth:!0,label:"Artist Name",name:"artist_name",value:o.artist_name,onChange:d,required:!0,disabled:r}),e.jsx(u,{fullWidth:!0,label:"Biography",name:"bio",value:o.bio,onChange:d,multiline:!0,rows:4,disabled:r}),e.jsx(u,{fullWidth:!0,label:"Portfolio/Website URL",name:"link",value:o.link,onChange:d,disabled:r}),e.jsx(u,{fullWidth:!0,label:"Contact Email",name:"contact_email",type:"email",value:o.contact_email,onChange:d,disabled:r}),e.jsx(u,{fullWidth:!0,label:"Phone Number",name:"phone",value:o.phone,onChange:d,disabled:r}),e.jsx(u,{fullWidth:!0,label:"Specialties",name:"specialties",value:o.specialties,onChange:d,placeholder:"e.g., Oil painting, Watercolor, Digital art",disabled:r}),e.jsx(u,{fullWidth:!0,label:"Commission Rate (%)",name:"commission_rate",type:"number",value:o.commission_rate,onChange:d,disabled:r}),e.jsx(F,{variant:"h6",sx:{mt:2},children:"Social Media Links"}),e.jsx(u,{fullWidth:!0,label:"Instagram URL",name:"social_instagram",value:o.social_links.instagram,onChange:d,disabled:r}),e.jsx(u,{fullWidth:!0,label:"Twitter URL",name:"social_twitter",value:o.social_links.twitter,onChange:d,disabled:r}),e.jsx(u,{fullWidth:!0,label:"Facebook URL",name:"social_facebook",value:o.social_links.facebook,onChange:d,disabled:r}),e.jsx(u,{fullWidth:!0,label:"Website URL",name:"social_website",value:o.social_links.website,onChange:d,disabled:r}),e.jsxs(m,{children:[e.jsx(F,{variant:"subtitle1",gutterBottom:!0,children:"Profile Photo"}),e.jsxs(m,{display:"flex",alignItems:"center",gap:2,children:[e.jsxs(C,{variant:"outlined",component:"label",disabled:r,children:["Choose Profile Photo",e.jsx("input",{type:"file",hidden:!0,accept:"image/*",onChange:a=>D(a,"avatar")})]}),(y.avatar||g.avatar)&&e.jsx(H,{src:y.avatar||g.avatar,sx:{width:80,height:80}}),(y.avatar||g.avatar)&&e.jsx(I,{color:"error",onClick:G,disabled:r,children:e.jsx(R,{})})]})]}),e.jsxs(m,{children:[e.jsx(F,{variant:"subtitle1",gutterBottom:!0,children:"Gallery Images"}),e.jsxs(C,{variant:"outlined",component:"label",disabled:r,sx:{mb:2},children:["Add Gallery Images",e.jsx("input",{type:"file",hidden:!0,accept:"image/*",multiple:!0,onChange:a=>D(a,"gallery")})]}),e.jsxs(m,{display:"flex",flexWrap:"wrap",gap:1,children:[y.gallery_images.map((a,t)=>e.jsxs(m,{position:"relative",children:[e.jsx(m,{component:"img",src:a,sx:{width:80,height:80,objectFit:"cover",borderRadius:1}}),e.jsx(I,{size:"small",color:"error",onClick:()=>M(t),sx:{position:"absolute",top:-8,right:-8},children:e.jsx(R,{size:16})})]},`new-${t}`)),g.gallery.map((a,t)=>e.jsxs(m,{position:"relative",children:[e.jsx(m,{component:"img",src:a.thumb||a.url,sx:{width:80,height:80,objectFit:"cover",borderRadius:1}}),e.jsx(I,{size:"small",color:"error",onClick:()=>N(t),sx:{position:"absolute",top:-8,right:-8},children:e.jsx(R,{size:16})})]},`existing-${a.id}`))]})]}),e.jsx(J,{control:e.jsx(X,{name:"is_active",checked:o.is_active,onChange:d,disabled:r}),label:"Active"}),e.jsxs(m,{sx:{display:"flex",gap:2,justifyContent:"flex-end"},children:[e.jsx(C,{variant:"outlined",onClick:$,disabled:r,children:"Cancel"}),e.jsx(C,{type:"submit",variant:"contained",disabled:r,startIcon:r?e.jsx(Q,{size:20}):null,children:r?"Saving...":x?"Update":"Create"})]})]})})]})};export{re as default};
