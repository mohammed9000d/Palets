import{a0 as P,a5 as D,a6 as A,r as l,j as s,M as L,B as v,F as _,a1 as M}from"./index-BCJT0FPu.js";import{u as j}from"./api-T5aaLTAo.js";import{A as S}from"./Alert-BtRUdvq8.js";import{T as p}from"./TextField-DcmIisSr.js";import{S as w}from"./Switch-Cpk3MaUk.js";import{B as E}from"./Button-Dbk6Y94U.js";import"./InputLabel-1PHilejO.js";const R=()=>{const g=P(),{id:c}=D(),f=A(),i=!!c,[n,h]=l.useState({name:"",email:"",password:"",phone:"",newsletter_subscription:!1,sms_notifications:!1,is_active:!0}),[t,d]=l.useState(!1),[y,u]=l.useState(""),[C,x]=l.useState("");l.useEffect(()=>{var r;if(i)if((r=f.state)!=null&&r.user){const e=f.state.user;h({name:e.name||"",email:e.email||"",password:"",phone:e.phone||"",newsletter_subscription:e.newsletter_subscription||!1,sms_notifications:e.sms_notifications||!1,is_active:e.is_active!==void 0?e.is_active:!0})}else F()},[c,i,f.state]);const F=async()=>{try{d(!0);const e=(await j.getById(c)).data;h({name:e.name||"",email:e.email||"",password:"",phone:e.phone||"",newsletter_subscription:e.newsletter_subscription||!1,sms_notifications:e.sms_notifications||!1,is_active:e.is_active!==void 0?e.is_active:!0})}catch(r){u("Failed to fetch user details"),console.error("Error fetching user:",r)}finally{d(!1)}},o=r=>{const{name:e,value:m,checked:a}=r.target;h(b=>({...b,[e]:e==="is_active"||e==="newsletter_subscription"||e==="sms_notifications"?a:m}))},U=async r=>{var e,m;r.preventDefault(),d(!0),u(""),x("");try{const a={...n};i&&!a.password&&delete a.password,i?(await j.update(c,a),x("User updated successfully!")):(await j.create(a),x("User created successfully!")),setTimeout(()=>{g("/admin/users")},2e3)}catch(a){if((m=(e=a.response)==null?void 0:e.data)!=null&&m.errors){const b=a.response.data.errors,B=Object.values(b).flat().join(", ");u(B)}else u("Failed to save user. Please try again.");console.error("Error saving user:",a)}finally{d(!1)}},k=()=>{g("/admin/users")};return s.jsxs(L,{title:i?"Edit User":"Create User",children:[y&&s.jsx(S,{severity:"error",sx:{mb:2},children:y}),C&&s.jsx(S,{severity:"success",sx:{mb:2},children:C}),s.jsx(v,{component:"form",onSubmit:U,noValidate:!0,children:s.jsxs(v,{sx:{display:"flex",flexDirection:"column",gap:3},children:[s.jsx(p,{fullWidth:!0,label:"Name",name:"name",value:n.name,onChange:o,required:!0,disabled:t}),s.jsx(p,{fullWidth:!0,label:"Email",name:"email",type:"email",value:n.email,onChange:o,required:!0,disabled:t}),s.jsx(p,{fullWidth:!0,label:"Password",name:"password",type:"password",value:n.password,onChange:o,required:!i,helperText:i?"Leave empty to keep current password":"",disabled:t}),s.jsx(p,{fullWidth:!0,label:"Phone",name:"phone",value:n.phone,onChange:o,disabled:t}),s.jsx(_,{control:s.jsx(w,{name:"is_active",checked:n.is_active,onChange:o,disabled:t}),label:"Active"}),s.jsx(_,{control:s.jsx(w,{name:"newsletter_subscription",checked:n.newsletter_subscription,onChange:o,disabled:t}),label:"Newsletter Subscription"}),s.jsx(_,{control:s.jsx(w,{name:"sms_notifications",checked:n.sms_notifications,onChange:o,disabled:t}),label:"SMS Notifications"}),s.jsxs(v,{sx:{display:"flex",gap:2,justifyContent:"flex-end"},children:[s.jsx(E,{variant:"outlined",onClick:k,disabled:t,children:"Cancel"}),s.jsx(E,{type:"submit",variant:"contained",disabled:t,startIcon:t?s.jsx(M,{size:20}):null,children:t?"Saving...":i?"Update":"Create"})]})]})})]})};export{R as default};
