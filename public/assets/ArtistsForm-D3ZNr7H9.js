import{a0 as V,a5 as Y,a6 as Z,r as h,j as e,M,B as c,a1 as N,G as r,J as S,K as W,T as p,F as ee,N as K,I as C,D as ae}from"./index-DvNQNAw1.js";import{b as B}from"./api-m0yHc7N1.js";import{A as O}from"./Alert-Jx1-EQGi.js";import{T as m}from"./TextField-CAljsaeA.js";import{I as te}from"./InputAdornment-DNft4k1e.js";import{S as se}from"./Switch-DwLl1WQW.js";import{I as w,a as q,b as ie}from"./IconX-CfXWwWIb.js";import{B as j}from"./Button-BsbqG4MF.js";import"./InputLabel-D0IGXPy6.js";const ge=()=>{const A=V(),{slug:f}=Y(),E=Z(),d=!!f,[H,D]=h.useState(!1),[v,L]=h.useState(!1),[P,_]=h.useState(""),[z,R]=h.useState(""),[n,I]=h.useState({artist_name:"",bio:"",link:"",is_active:!0,contact_email:"",phone:"",specialties:"",commission_rate:"",social_links:{instagram:"",twitter:"",facebook:"",website:""}}),[J,b]=h.useState({avatar:null,gallery_images:[]}),[y,k]=h.useState({avatar:null,gallery_images:[]}),[x,F]=h.useState({avatar:null,gallery_images:[]});h.useEffect(()=>{var a;d&&((a=E.state)!=null&&a.artist?T(E.state.artist):X())},[d,f]);const X=async()=>{try{D(!0);const a=await B.getBySlug(f);T(a.data.artist)}catch(a){_("Failed to fetch artist data"),console.error("Error fetching artist:",a)}finally{D(!1)}},T=a=>{I({artist_name:a.artist_name||"",bio:a.bio||"",link:a.link||"",is_active:a.is_active,contact_email:a.contact_email||"",phone:a.phone||"",specialties:a.specialties||"",commission_rate:a.commission_rate||"",social_links:a.social_links||{instagram:"",twitter:"",facebook:"",website:""}}),F({avatar:a.avatar_url?{url:a.avatar_url,thumb:a.avatar_thumb_url}:null,gallery_images:a.gallery_images||[]})},o=a=>{const{name:s,value:t,type:i,checked:l}=a.target;if(s.startsWith("social_links.")){const u=s.split(".")[1];I(g=>({...g,social_links:{...g.social_links,[u]:t}}))}else I(u=>({...u,[s]:i==="checkbox"?l:t}))},U=(a,s)=>{const t=Array.from(a.target.files);if(s==="avatar"){const i=t[0];if(i){b(u=>({...u,avatar:i}));const l=new FileReader;l.onload=u=>{k(g=>({...g,avatar:u.target.result}))},l.readAsDataURL(i)}}else s==="gallery_images"&&(b(i=>({...i,gallery_images:[...i.gallery_images,...t]})),t.forEach(i=>{const l=new FileReader;l.onload=u=>{k(g=>({...g,gallery_images:[...g.gallery_images,u.target.result]}))},l.readAsDataURL(i)}))},$=(a,s)=>{a==="avatar"?(b(t=>({...t,avatar:null})),k(t=>({...t,avatar:null}))):a==="gallery_images"&&(b(t=>({...t,gallery_images:t.gallery_images.filter((i,l)=>l!==s)})),k(t=>({...t,gallery_images:t.gallery_images.filter((i,l)=>l!==s)})))},G=(a,s)=>{a==="avatar"?F(t=>({...t,avatar:null})):a==="gallery_images"&&F(t=>({...t,gallery_images:t.gallery_images.filter((i,l)=>l!==s)}))},Q=async a=>{var s,t;a.preventDefault(),L(!0),_(""),R("");try{const i={...n,...J};d&&(x.avatar||(i.remove_avatar=!0));let l;d?l=await B.update(f,i):l=await B.create(i),R(`Artist ${d?"updated":"created"} successfully!`),setTimeout(()=>{A("/admin/artists")},2e3)}catch(i){if((t=(s=i.response)==null?void 0:s.data)!=null&&t.errors){const l=Object.values(i.response.data.errors).flat();_(l.join(", "))}else _(`Failed to ${d?"update":"create"} artist`);console.error("Error submitting form:",i)}finally{L(!1)}};return H?e.jsx(M,{title:d?"Edit Artist":"Create Artist",children:e.jsx(c,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsx(N,{})})}):e.jsxs(M,{title:d?"Edit Artist":"Create New Artist",secondary:e.jsx(j,{startIcon:e.jsx(ie,{}),onClick:()=>A("/admin/artists"),children:"Back to Artists"}),children:[P&&e.jsx(O,{severity:"error",sx:{mb:2},children:P}),z&&e.jsx(O,{severity:"success",sx:{mb:2},children:z}),e.jsx("form",{onSubmit:Q,children:e.jsxs(r,{container:!0,spacing:3,children:[e.jsx(r,{item:!0,xs:12,children:e.jsx(S,{children:e.jsxs(W,{children:[e.jsx(p,{variant:"h6",gutterBottom:!0,children:"Basic Information"}),e.jsxs(r,{container:!0,spacing:2,children:[e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsx(m,{fullWidth:!0,label:"Artist Name",name:"artist_name",value:n.artist_name,onChange:o,required:!0})}),e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsx(m,{fullWidth:!0,label:"Contact Email",name:"contact_email",type:"email",value:n.contact_email,onChange:o})}),e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsx(m,{fullWidth:!0,label:"Phone",name:"phone",value:n.phone,onChange:o})}),e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsx(m,{fullWidth:!0,label:"Portfolio/Website Link",name:"link",value:n.link,onChange:o})}),e.jsx(r,{item:!0,xs:12,children:e.jsx(m,{fullWidth:!0,label:"Biography",name:"bio",value:n.bio,onChange:o,multiline:!0,rows:4})}),e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsx(m,{fullWidth:!0,label:"Art Specialties",name:"specialties",value:n.specialties,onChange:o,placeholder:"e.g., Oil painting, Watercolor, Digital art"})}),e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsx(m,{fullWidth:!0,label:"Commission Rate",name:"commission_rate",type:"number",value:n.commission_rate,onChange:o,InputProps:{endAdornment:e.jsx(te,{position:"end",children:"%"})}})}),e.jsx(r,{item:!0,xs:12,children:e.jsx(ee,{control:e.jsx(se,{checked:n.is_active,onChange:o,name:"is_active"}),label:"Active Artist"})})]})]})})}),e.jsx(r,{item:!0,xs:12,children:e.jsx(S,{children:e.jsxs(W,{children:[e.jsx(p,{variant:"h6",gutterBottom:!0,children:"Social Media Links"}),e.jsxs(r,{container:!0,spacing:2,children:[e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsx(m,{fullWidth:!0,label:"Instagram",name:"social_links.instagram",value:n.social_links.instagram,onChange:o,placeholder:"@username"})}),e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsx(m,{fullWidth:!0,label:"Twitter",name:"social_links.twitter",value:n.social_links.twitter,onChange:o,placeholder:"@username"})}),e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsx(m,{fullWidth:!0,label:"Facebook",name:"social_links.facebook",value:n.social_links.facebook,onChange:o,placeholder:"Facebook page name"})}),e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsx(m,{fullWidth:!0,label:"Website",name:"social_links.website",value:n.social_links.website,onChange:o,placeholder:"https://example.com"})})]})]})})}),e.jsx(r,{item:!0,xs:12,children:e.jsx(S,{children:e.jsxs(W,{children:[e.jsx(p,{variant:"h6",gutterBottom:!0,children:"Images"}),e.jsxs(c,{mb:3,children:[e.jsx(p,{variant:"subtitle1",gutterBottom:!0,children:"Profile Avatar"}),e.jsxs(c,{display:"flex",alignItems:"center",gap:2,mb:2,children:[x.avatar&&e.jsxs(c,{position:"relative",children:[e.jsx(K,{src:x.avatar.thumb,sx:{width:80,height:80}}),e.jsx(C,{size:"small",color:"error",sx:{position:"absolute",top:-8,right:-8},onClick:()=>G("avatar"),children:e.jsx(w,{size:16})})]}),y.avatar&&e.jsxs(c,{position:"relative",children:[e.jsx(K,{src:y.avatar,sx:{width:80,height:80}}),e.jsx(C,{size:"small",color:"error",sx:{position:"absolute",top:-8,right:-8},onClick:()=>$("avatar"),children:e.jsx(w,{size:16})})]})]}),e.jsx("input",{type:"file",accept:"image/*",onChange:a=>U(a,"avatar"),style:{display:"none"},id:"avatar-upload"}),e.jsx("label",{htmlFor:"avatar-upload",children:e.jsx(j,{variant:"outlined",component:"span",startIcon:e.jsx(q,{}),children:"Upload Avatar"})})]}),e.jsx(ae,{sx:{my:2}}),e.jsxs(c,{children:[e.jsx(p,{variant:"subtitle1",gutterBottom:!0,children:"Gallery Images"}),x.gallery_images.length>0&&e.jsx(c,{display:"flex",flexWrap:"wrap",gap:1,mb:2,children:x.gallery_images.map((a,s)=>e.jsxs(c,{position:"relative",children:[e.jsx("img",{src:a.thumb,alt:`Gallery ${s}`,style:{width:80,height:80,objectFit:"cover",borderRadius:4}}),e.jsx(C,{size:"small",color:"error",sx:{position:"absolute",top:-8,right:-8},onClick:()=>G("gallery_images",s),children:e.jsx(w,{size:16})})]},s))}),y.gallery_images.length>0&&e.jsx(c,{display:"flex",flexWrap:"wrap",gap:1,mb:2,children:y.gallery_images.map((a,s)=>e.jsxs(c,{position:"relative",children:[e.jsx("img",{src:a,alt:`Preview ${s}`,style:{width:80,height:80,objectFit:"cover",borderRadius:4}}),e.jsx(C,{size:"small",color:"error",sx:{position:"absolute",top:-8,right:-8},onClick:()=>$("gallery_images",s),children:e.jsx(w,{size:16})})]},s))}),e.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:a=>U(a,"gallery_images"),style:{display:"none"},id:"gallery-upload"}),e.jsx("label",{htmlFor:"gallery-upload",children:e.jsx(j,{variant:"outlined",component:"span",startIcon:e.jsx(q,{}),children:"Add Gallery Images"})})]})]})})}),e.jsx(r,{item:!0,xs:12,children:e.jsxs(c,{display:"flex",justifyContent:"flex-end",gap:2,children:[e.jsx(j,{variant:"outlined",onClick:()=>A("/admin/artists"),disabled:v,children:"Cancel"}),e.jsx(j,{type:"submit",variant:"contained",disabled:v,startIcon:v?e.jsx(N,{size:20}):null,children:v?`${d?"Updating":"Creating"}...`:`${d?"Update":"Create"} Artist`})]})})]})})]})};export{ge as default};
